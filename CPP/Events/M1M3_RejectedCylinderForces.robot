*** Settings ***
Documentation    M1M3_RejectedCylinderForces communications tests.
Force Tags    cpp    TSS-2617
Suite Setup    Run Keywords    Log Many    ${Host}    ${subSystem}    ${component}    ${timeout}
...    AND    Create Session    Sender    AND    Create Session    Logger
Suite Teardown    Close All Connections
Library    SSHLibrary
Resource    ../../Global_Vars.robot
Resource    ../../common.robot

*** Variables ***
${subSystem}    m1m3
${component}    RejectedCylinderForces
${timeout}    30s

*** Test Cases ***
Verify Component Sender and Logger
    [Tags]    smoke
    File Should Exist    ${SALWorkDir}/${subSystem}/cpp/src/sacpp_${subSystem}_${component}_send
    File Should Exist    ${SALWorkDir}/${subSystem}/cpp/src/sacpp_${subSystem}_${component}_log

Start Sender - Verify Missing Inputs Error
    [Tags]    functional
    Switch Connection    Sender
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/cpp/src
    Comment    Start Sender.
    ${input}=    Write    ./sacpp_${subSystem}_${component}_send 
    ${output}=    Read Until Prompt
    Log    ${output}
    Should Contain    ${output}   Usage :  input parameters...

Start Logger
    [Tags]    functional
    Switch Connection    Logger
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/cpp/src
    Comment    Start Logger.
    ${input}=    Write    ./sacpp_${subSystem}_${component}_log
    ${output}=    Read Until    logger ready =
    Log    ${output}
    Should Contain    ${output}    Event ${component} logger ready

Start Sender
    [Tags]    functional
    Switch Connection    Sender
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/cpp/src
    Comment    Start Sender.
    ${input}=    Write    ./sacpp_${subSystem}_${component}_send 20.9086 1452972360 -1500533736 -1686957560 72398496 2045313688 500542475 1316242535 2051202431 -1568917098 1693927287 614798498 1188252804 -198114160 -156423735 2064580969 1384472465 1258901827 -1541211470 1780749967 -323311245 2011510569 -2125802287 1795501520 -1226257353 12825625 -2078145046 -2009359001 -1499855563 560723654 -1129883144 -476360470 1786171877 -1385097320 941443734 1005779082 -533039356 -1887712351 -568505884 -73971390 -1160729197 1636353978 3733343 -2122129302 -242721932 1165951926 -984452285 -1922386844 -261454736 430682244 2083166644 860339282 -2001361877 -1015563482 1759828871 1440375030 1521167675 790457697 879184002 362259731 1450557452 1728716825 1927777274 -147109339 -1598878974 -138688947 635330805 2122432348 -390699916 621254452 803704229 -1172551993 817263944 -1690187241 -1097452936 1401163586 1800029427 678881339 -159718270 -215893678 771591897 1971548079 992571125 556405927 -645298088 -1684381688 -1853434447 1216437992 2043103262 1771995431 -158241093 1644877875 -1416904986 -1064738363 920039594 -1767349593 900277219 610011648 -254395631 -1570110268 868896093 -1204572391 -1695813218 2051843264 1165248185 86744934 1785602150 -1717452351 -2067904541 1074715034 2077225842 1662611188 126701125 -98761263 1106599317 1290859732 464410690 -1265601857 1282246419 -262050804 -29141563 -1992477488 1344236163 -1078616518 1041985651 303163442 766847777 1464678015 -12616522 2139952553 396616043 1354649395 -385406053 1585497707 1264775836 251038704 -999627207 -1372756589 -49133812 1293322941 32069278 -1767259522 -1523169490 1944111544 -1639917242 -1648030134 892332145 -1596383932 447002702 603464943 876493607 1750190254 -1900963912 622526624 1549806355 1806994780 1187517953 1476052634 1458132123 1021059584 -1839207446 1497881097 161693938 -57477883 1301013651 -1563864896 -275228031 2077446237 60550751 1903857744 -342765227 -248131508 -1533486412 -1436869053 368345997 -238200687 -1783375487 526423883 2109830444 1258712449 -118870626 -318144201 1432339930 -673545548 530330000 -657432293 -330618626 2051417849 767272074 -1407435520 1812538047 491390382 329368416 -1435354282 -1106954004 2074778973 -844501076 555346683 1720429224 1612427051 273860860 -1708226189 -1959921408 1932421857 1576137965 -2004538503 708687503 -524196558 86617045 -1512205610 573364087 1660515477 261151532 -2061498802 1010583370 1885663248 1397253858 1489043194 2022416196 1232262461 -2127530784 -1311013080 -1464211869 41608354 -2029403921 1893406376 -2095600183 -583677340 1327178609 -977551620 -349863702 261952443 -1271619266 -2066756034 312002120 1222501645 -1671534280 94218433 1059449857 777289308 1960583871 157800374 -1962649027 -562362537 347316780 316726443 -2038756174 978983649 -976647675 -421811991 -2045820763 -1222067649 1474130967 -17633243 351192144 1115973636 324029061 -397462874 -145044123 763002896 -274395024 1974308751 600959592 -191427213 -1463294559 1684264156 -1325236624 1915292657 2109596769 -455588856
    ${output}=    Read Until Prompt
    Log    ${output}
    Should Contain X Times    ${output}    === [putSample] m1m3::logevent_RejectedCylinderForces writing a message containing :    1
    Should Contain    ${output}    revCode \ :
    Should Contain    ${output}    === Event RejectedCylinderForces generated =

Read Logger
    [Tags]    functional
    Switch Connection    Logger
    ${output}=    Read Until    priority : -455588856
    Log    ${output}
    Should Contain X Times    ${output}    === Event RejectedCylinderForces received =     1
    Should Contain    ${output}    Timestamp : 20.9086
    Should Contain    ${output}    SecondaryCylinderForces : 1452972360
    Should Contain    ${output}    PrimaryCylinderForces : -1500533736
    Should Contain    ${output}    priority : -1686957560
