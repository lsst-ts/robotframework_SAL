*** Settings ***
Documentation    M1M3_RejectedCylinderForces communications tests.
Force Tags    cpp    TSS-2617
Suite Setup    Run Keywords    Log Many    ${Host}    ${subSystem}    ${component}    ${timeout}
...    AND    Create Session    Sender    AND    Create Session    Logger
Suite Teardown    Close All Connections
Library    SSHLibrary
Resource    ../../Global_Vars.robot
Resource    ../../common.robot

*** Variables ***
${subSystem}    m1m3
${component}    RejectedCylinderForces
${timeout}    30s

*** Test Cases ***
Verify Component Sender and Logger
    [Tags]    smoke
    File Should Exist    ${SALWorkDir}/${subSystem}/cpp/src/sacpp_${subSystem}_${component}_send
    File Should Exist    ${SALWorkDir}/${subSystem}/cpp/src/sacpp_${subSystem}_${component}_log

Start Sender - Verify Missing Inputs Error
    [Tags]    functional
    Switch Connection    Sender
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/cpp/src
    Comment    Start Sender.
    ${input}=    Write    ./sacpp_${subSystem}_${component}_send 
    ${output}=    Read Until Prompt
    Log    ${output}
    Should Contain    ${output}   Usage :  input parameters...

Start Logger
    [Tags]    functional
    Switch Connection    Logger
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/cpp/src
    Comment    Start Logger.
    ${input}=    Write    ./sacpp_${subSystem}_${component}_log
    ${output}=    Read Until    logger ready =
    Log    ${output}
    Should Contain    ${output}    Event ${component} logger ready

Start Sender
    [Tags]    functional
    Switch Connection    Sender
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/cpp/src
    Comment    Start Sender.
    ${input}=    Write    ./sacpp_${subSystem}_${component}_send 86.9998 1549500708 -653875107 1502607232 -1437718289 1359623548 989694743 335380432 776008889 189029084 -1866574759 -1724574068 1777561053 896067326 25747099 -488603527 638604556 595541134 1677213621 -1990614656 870302005 154943466 1362928004 -943147298 -474837256 -1516039838 455060769 2031418253 2099155862 1973847161 1908354240 -1540886470 -1367722427 -1690729731 952512313 -1014667851 -2145654740 -1519465239 508473939 -453433093 929386301 -1418656822 -297572136 450866939 1327848905 -1595475990 -1773028607 361808129 -1508506599 -495703544 -1495130651 1799387309 1497958095 -276930887 1474330823 197051770 -1258284314 -396688144 734250474 647055844 -280159115 2139605187 540864850 1263311024 2005329064 -1738176076 935583813 -956105196 -530347743 359562403 -289532828 1678592662 -1475549403 -1454409219 1652801899 691888184 -215399006 -1505990607 1117399406 1034471777 -27708559 183846160 -2029148606 -1778398566 1355921859 1372811010 -745033540 2139784352 -1687378570 254491984 1653920265 906951703 -2128811532 -1677148771 -1863079200 -1458866089 1722251216 -457425833 -374824064 -1680586095 712242363 1931588573 -1270529931 -740932399 436675692 2116449554 326664714 1067467892 -1104233293 -1619778557 -1984016055 1216490521 2113160692 -103026840 292894186 -1111928714 -1472327766 1521306788 -421706685 -846915583 -1381580256 1259981051 -1792434094 1576726998 49457391 -1718498245 2062085331 1493845610 -1515492934 1030032762 -1810907793 1822872578 1136793884 -883242651 -1277532282 428109279 1319279303 -706846356 -1322013352 461325391 -2098342846 -466917344 1438869344 -430160800 1513943348 -1787301092 1550071845 -676644610 1757649258 -489659657 -110070357 -1519396962 509153833 -14716488 301368882 -247592769 -2049041184 -1461164798 -2001834152 1880374330 1491803242 -862058007 387343305 -379617798 -740863601 964631115 440389670 883339874 1948426085 82092457 -628041169 -1624804719 1267834245 -582225614 -955345639 -178425321 616152521 -564947185 -1849447254 -1497264866 1374669790 1700554575 2093677740 -259231854 1874868014 678632361 -793041980 -438428775 939395226 -1832802954 -847923372 354551443 -1146475073 -1167047453 1035079255 59985730 -90231005 153140331 -1823017613 1231533285 1441809177 -1825756984 -927322262 -1597253393 15117900 440590861 472851225 -1330856737 1022408247 -1080971988 1360550510 1223516270 1006640777 -456524820 797930236 -19349859 -1194795314 -215135603 676468123 856331852 -696883565 515327970 2023439673 2036577748 -447490423 1984758962 904032459 -791968361 -2129390846 958864235 1178050967 -1254937695 -1417177522 2105416231 -1205518522 -1469959435 -1322169897 827847904 -1905511720 -1988541428 659368159 -1031773897 709162707 -1673007059 -443091658 -889437087 -1561775608 -394427673 1463961174 2052111976 1994273368 -827725564 -825797103 -1707265304 1814663136 1676063347 -138451127 -1833441555 1400340754 -592513593 126558144 -1809959426 -425531062 -1182744034 470257236 423224679 708803608 1698258084 14059910 -792292073
    ${output}=    Read Until Prompt
    Log    ${output}
    Should Contain X Times    ${output}    === [putSample] m1m3::logevent_RejectedCylinderForces writing a message containing :    1
    Should Contain    ${output}    revCode \ :
    Should Contain    ${output}    === Event RejectedCylinderForces generated =

Read Logger
    [Tags]    functional
    Switch Connection    Logger
    ${output}=    Read Until    priority : -792292073
    Log    ${output}
    Should Contain X Times    ${output}    === Event RejectedCylinderForces received =     1
    Should Contain    ${output}    Timestamp : 86.9998
    Should Contain    ${output}    SecondaryCylinderForces : 1549500708
    Should Contain    ${output}    PrimaryCylinderForces : -653875107
    Should Contain    ${output}    priority : 1502607232
