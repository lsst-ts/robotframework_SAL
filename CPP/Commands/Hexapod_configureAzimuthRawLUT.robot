*** Settings ***
Documentation    Hexapod_configureAzimuthRawLUT commander/controller tests.
Force Tags    cpp    
Suite Setup    Run Keywords    Log Many    ${Host}    ${subSystem}    ${component}    ${timeout}
...    AND    Create Session    Commander    AND    Create Session    Controller
Suite Teardown    Close All Connections
Library    SSHLibrary
Library    String
Resource    ../../Global_Vars.robot
Resource    ../../common.robot

*** Variables ***
${subSystem}    hexapod
${component}    configureAzimuthRawLUT
${timeout}    30s

*** Test Cases ***
Verify Component Commander and Controller
    [Tags]    smoke
    File Should Exist    ${SALWorkDir}/${subSystem}/cpp/src/sacpp_${subSystem}_${component}_commander
    File Should Exist    ${SALWorkDir}/${subSystem}/cpp/src/sacpp_${subSystem}_${component}_controller

Start Commander - Verify Missing Inputs Error
    [Tags]    functional
    Switch Connection    Commander
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/cpp/src
    Comment    Start Commander.
    ${input}=    Write    ./sacpp_${subSystem}_${component}_commander 
    ${output}=    Read Until Prompt
    Log    ${output}
    Should Contain    ${output}   Usage : \ input parameters...

Start Commander - Verify Timeout without Controller
    [Tags]    functional
    Switch Connection    Commander
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/cpp/src
    Comment    Start Commander.
    ${input}=    Write    ./sacpp_${subSystem}_${component}_commander -20856 -7976 -31399 -18245 9441 11487 -8508 13179 -21919 10626 29481 9839 28274 23620 26375 -7224 -6561 -32410 29075 -11207 -5703 -16002 -25078 -12124 28838 -28582 27990 -7852 12170 -14468 8718 11508 14532 -20623 11101 15661 -13798 0.970785961954 0.234689037294 0.989318543641 0.471779185335 0.594162029631 0.890968270354 0.499750757754 0.370666049427 0.516406150285 0.41609038317 0.133267927028 0.138405463282 0.886713320327 0.681470957955 0.4942253103 0.693111161232 0.942047444416 0.535274793879 0.465537263948 0.544426767991 0.738793632215 0.330629186793 0.107662007218 0.903525349111 0.842735638587 0.375175470146 0.810353207356 0.363685475434 0.00523640018826 0.289940391103 0.830734708513 0.991077998545 0.547024776389 0.0893492709569 0.738151550005 0.435396631661 0.304659767681 0.544236904032 0.913808108377 0.0650366033961 0.659562564632 0.337693078573 0.746721434912 0.364239570998 0.692985771077 0.332406048876 0.840491760744 0.993400877454 0.403625454801 0.352588263786 0.0758687977796 0.162677748581 0.869239010739 0.680308091447 0.230313753949 0.80576603104 0.0387233576984 0.200123348001 0.305777339812 0.514958779207 0.326823788035 0.349396028624 0.674064768468 0.35667632065 0.100589239591 0.834625683398 0.369575027604 0.436020477927 0.532548187533 0.455683788381 0.667906760275 0.6980784286 0.423727760577 0.0912469862576 0.0758213566172 0.418215351022 0.399498742071 0.750028503081 0.260370064026 0.00892265625276 0.0369615129936 0.840615346376 0.482999933649 0.271488019746 0.359740978472 0.732736870957 0.529281982846 0.981378735587 0.382222467509 0.964535380222 0.874079769174 0.799687760908 0.52024973727 0.50626681665 0.98291956824 0.482521023363 0.932143823082 0.658633884684 0.619951362299 0.961517125456 0.57422723721 0.222725239566 0.867332191002 0.12184412023 0.838271823357 0.745868148892 0.949369636142 0.993978063795 0.018095475726 0.409277714995 0.167084156788 0.835377700538 0.724421753919 0.232575647622 0.479625416381 0.999641367011 0.538122123917 0.307556929965 0.27924993077 0.415678466084 0.888454854933 0.947854914473 0.453822348604 0.61802864849 0.285343617805 0.780656814103 0.253223092433 0.455569399086 0.725307559973 0.949832395476 0.295090406555 0.789146400471 0.0179398543034 0.663191711752 0.522696394176 0.622593774355 0.487181332256 0.644422869232 0.658529330437 0.792612563647 0.00798428933006 0.679163146035 0.841538532186 0.732479158144 0.776951720711 0.566972823731 0.844299378595 0.00967195504869 0.56927172179 0.467817075764 0.372027162374 0.064339129917 0.424012644581 0.847384482006 0.150208775573 0.52898479607 0.643867273535 0.42831733275 0.500519186927 0.505022918925 0.32365353539 0.79842293954 0.790265721159 0.605167382558 0.15294562591 0.901705351771 0.838954392384 0.334657564957 0.211778549234 0.705414865362 0.368110214631 0.260775764864 0.826783876331 0.99954278263 0.707868595549 0.0160752904829 0.338730384429 0.776722691859 0.0634710762462 0.0974783186485 0.586877981649 0.0861459561813 0.647107494673 0.573352912553 0.542915379793 0.167262527118 0.899603491606 0.744796826909 0.935565459702 0.829330075557 0.554445826572 0.230622588704 0.0815691295651 0.717376916479 0.226802661497 0.0996462782228 0.869848521423 0.631961527047 0.262503711471 0.560256915529 0.116245413735 0.8490051006 0.122078832737 0.904752966692 0.0870029197184 0.669117710301 0.320930770447 0.578553307311 0.39385440095 0.288019367268 0.680177591205 0.289518872963 0.909863032564 0.711054704557 0.369195969281 0.612972801014 0.287627213672 0.442218605885 0.0161298840195 0.0342058874699 0.249752039685 0.211975272173
    ${output}=    Read Until Prompt
    Log    ${output}
    ${CmdComplete}=    Get Line    ${output}    -2
    Should Match Regexp    ${CmdComplete}    (=== \\[waitForCompletion_${component}\\] command )[0-9]+( timed out :)

Start Controller
    [Tags]    functional
    Switch Connection    Controller
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/cpp/src
    Comment    Start Controller.
    ${input}=    Write    ./sacpp_${subSystem}_${component}_controller
    ${output}=    Read Until    controller ready
    Log    ${output}
    Should Contain    ${output}    ${subSystem}_${component} controller ready

Start Commander
    [Tags]    functional
    Switch Connection    Commander
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/cpp/src
    Comment    Start Commander.
    ${input}=    Write    ./sacpp_${subSystem}_${component}_commander -20856 -7976 -31399 -18245 9441 11487 -8508 13179 -21919 10626 29481 9839 28274 23620 26375 -7224 -6561 -32410 29075 -11207 -5703 -16002 -25078 -12124 28838 -28582 27990 -7852 12170 -14468 8718 11508 14532 -20623 11101 15661 -13798 0.970785961954 0.234689037294 0.989318543641 0.471779185335 0.594162029631 0.890968270354 0.499750757754 0.370666049427 0.516406150285 0.41609038317 0.133267927028 0.138405463282 0.886713320327 0.681470957955 0.4942253103 0.693111161232 0.942047444416 0.535274793879 0.465537263948 0.544426767991 0.738793632215 0.330629186793 0.107662007218 0.903525349111 0.842735638587 0.375175470146 0.810353207356 0.363685475434 0.00523640018826 0.289940391103 0.830734708513 0.991077998545 0.547024776389 0.0893492709569 0.738151550005 0.435396631661 0.304659767681 0.544236904032 0.913808108377 0.0650366033961 0.659562564632 0.337693078573 0.746721434912 0.364239570998 0.692985771077 0.332406048876 0.840491760744 0.993400877454 0.403625454801 0.352588263786 0.0758687977796 0.162677748581 0.869239010739 0.680308091447 0.230313753949 0.80576603104 0.0387233576984 0.200123348001 0.305777339812 0.514958779207 0.326823788035 0.349396028624 0.674064768468 0.35667632065 0.100589239591 0.834625683398 0.369575027604 0.436020477927 0.532548187533 0.455683788381 0.667906760275 0.6980784286 0.423727760577 0.0912469862576 0.0758213566172 0.418215351022 0.399498742071 0.750028503081 0.260370064026 0.00892265625276 0.0369615129936 0.840615346376 0.482999933649 0.271488019746 0.359740978472 0.732736870957 0.529281982846 0.981378735587 0.382222467509 0.964535380222 0.874079769174 0.799687760908 0.52024973727 0.50626681665 0.98291956824 0.482521023363 0.932143823082 0.658633884684 0.619951362299 0.961517125456 0.57422723721 0.222725239566 0.867332191002 0.12184412023 0.838271823357 0.745868148892 0.949369636142 0.993978063795 0.018095475726 0.409277714995 0.167084156788 0.835377700538 0.724421753919 0.232575647622 0.479625416381 0.999641367011 0.538122123917 0.307556929965 0.27924993077 0.415678466084 0.888454854933 0.947854914473 0.453822348604 0.61802864849 0.285343617805 0.780656814103 0.253223092433 0.455569399086 0.725307559973 0.949832395476 0.295090406555 0.789146400471 0.0179398543034 0.663191711752 0.522696394176 0.622593774355 0.487181332256 0.644422869232 0.658529330437 0.792612563647 0.00798428933006 0.679163146035 0.841538532186 0.732479158144 0.776951720711 0.566972823731 0.844299378595 0.00967195504869 0.56927172179 0.467817075764 0.372027162374 0.064339129917 0.424012644581 0.847384482006 0.150208775573 0.52898479607 0.643867273535 0.42831733275 0.500519186927 0.505022918925 0.32365353539 0.79842293954 0.790265721159 0.605167382558 0.15294562591 0.901705351771 0.838954392384 0.334657564957 0.211778549234 0.705414865362 0.368110214631 0.260775764864 0.826783876331 0.99954278263 0.707868595549 0.0160752904829 0.338730384429 0.776722691859 0.0634710762462 0.0974783186485 0.586877981649 0.0861459561813 0.647107494673 0.573352912553 0.542915379793 0.167262527118 0.899603491606 0.744796826909 0.935565459702 0.829330075557 0.554445826572 0.230622588704 0.0815691295651 0.717376916479 0.226802661497 0.0996462782228 0.869848521423 0.631961527047 0.262503711471 0.560256915529 0.116245413735 0.8490051006 0.122078832737 0.904752966692 0.0870029197184 0.669117710301 0.320930770447 0.578553307311 0.39385440095 0.288019367268 0.680177591205 0.289518872963 0.909863032564 0.711054704557 0.369195969281 0.612972801014 0.287627213672 0.442218605885 0.0161298840195 0.0342058874699 0.249752039685 0.211975272173
    ${output}=    Read Until Prompt
    Log    ${output}
    Should Contain X Times    ${output}    === [issueCommand_${component}] writing a command containing :    1
    Should Contain X Times    ${output}    device :     1
    Should Contain X Times    ${output}    property :     1
    Should Contain X Times    ${output}    action :     1
    Should Contain X Times    ${output}    value :     1
    Should Contain X Times    ${output}    azIndex : -20856    1
    Should Contain X Times    ${output}    fz1 : 0.970785961954    1
    Should Contain X Times    ${output}    fz2 : 0.544236904032    1
    Should Contain X Times    ${output}    fz3 : 0.0758213566172    1
    Should Contain X Times    ${output}    fz4 : 0.835377700538    1
    Should Contain X Times    ${output}    fz5 : 0.56927172179    1
    Should Contain X Times    ${output}    fz6 : 0.167262527118    1
    Should Contain    ${output}    === command configureAzimuthRawLUT issued =
    ${CmdComplete}=    Get Line    ${output}    -2
    Should Match Regexp    ${CmdComplete}    (=== \\[waitForCompletion_${component}\\] command )[0-9]+( completed ok :)

Read Controller
    [Tags]    functional
    Switch Connection    Controller
    ${output}=    Read Until    result \ \ : Done : OK
    Log    ${output}
    Should Contain    ${output}    === command configureAzimuthRawLUT received =
    Should Contain    ${output}    device : 
    Should Contain    ${output}    property : 
    Should Contain    ${output}    action : 
    Should Contain    ${output}    value : 
    Should Contain X Times    ${output}    azIndex : -20856    1
    Should Contain X Times    ${output}    fz1 : 0.970785961954    1
    Should Contain X Times    ${output}    fz2 : 0.544236904032    1
    Should Contain X Times    ${output}    fz3 : 0.0758213566172    1
    Should Contain X Times    ${output}    fz4 : 0.835377700538    1
    Should Contain X Times    ${output}    fz5 : 0.56927172179    1
    Should Contain X Times    ${output}    fz6 : 0.167262527118    1
    Should Contain X Times    ${output}    === [ackCommand_configureAzimuthRawLUT] acknowledging a command with :    2
    Should Contain    ${output}    seqNum   :
    Should Contain    ${output}    ack      : 301
    Should Contain X Times    ${output}    error \ \ \ : 0    2
    Should Contain    ${output}    result   : Ack : OK
    Should Contain    ${output}    ack      : 303
    Should Contain    ${output}    result   : Done : OK
