*** Settings ***
Documentation    Hexapod_configureLut commander/controller tests.
Suite Setup    Log Many    ${Host}    ${subSystem}    ${component}    ${timeout}
Suite Teardown    Close All Connections
Library    SSHLibrary
Resource    ../../Global_Vars.robot

*** Variables ***
${subSystem}    hexapod
${component}    configureLut
${timeout}    30s

*** Test Cases ***
Create Commander Session
    [Documentation]    Connect to the SAL host.
    [Tags]    smoke
    Comment    Connect to host.
    Open Connection    host=${Host}    alias=Commander    timeout=${timeout}    prompt=${Prompt}
    Comment    Login.
    Log    ${ContInt}
    Run Keyword If    "${ContInt}"=="false"    Login    ${UserName}    ${PassWord}
    Run Keyword If    "${ContInt}"=="true"    Login With Public Key    ${UserName}    keyfile=${PassWord}
    Directory Should Exist    ${SALInstall}
    Directory Should Exist    ${SALHome}
    Directory Should Exist    ${SALWorkDir}/${subSystem}

Create Controller Session
    [Documentation]    Connect to the SAL host.
    [Tags]    smoke
    Comment    Connect to host.
    Open Connection    host=${Host}    alias=Controller    timeout=${timeout}    prompt=${Prompt}
    Comment    Login.
    Log    ${ContInt}
    Run Keyword If    "${ContInt}"=="false"    Login    ${UserName}    ${PassWord}
    Run Keyword If    "${ContInt}"=="true"    Login With Public Key    ${UserName}    keyfile=${PassWord}
    Directory Should Exist    ${SALInstall}
    Directory Should Exist    ${SALHome}
    Directory Should Exist    ${SALWorkDir}/${subSystem}

Verify Component Commander and Controller
    [Tags]    smoke
    File Should Exist    ${SALWorkDir}/${subSystem}/cpp/src/sacpp_${subSystem}_${component}_commander
    File Should Exist    ${SALWorkDir}/${subSystem}/cpp/src/sacpp_${subSystem}_${component}_controller

Start Commander - Verify Missing Inputs Error
    [Tags]    functional
    Switch Connection    Commander
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/cpp/src
    Comment    Start Commander.
    ${input}=    Write    ./sacpp_${subSystem}_${component}_commander 
    ${output}=    Read Until Prompt
    Log    ${output}
    Should Contain    ${output}   Usage : \ input parameters...

Start Commander - Verify Timeout without Controller
    [Tags]    functional
    Switch Connection    Commander
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/cpp/src
    Comment    Start Commander.
    ${input}=    Write    ./sacpp_${subSystem}_${component}_commander 64.7156 1.1866 23.3254 58.8797 57.7212 26.7794 35.1605 16.3639 55.4776 64.6297 67.3322 61.1595 12.959 88.9673 37.3283 2.748 18.3696 94.5707 56.9031 40.2542 82.547 9.0201 3.1041 53.621 50.826 94.6301 10.4961 72.4299 99.8942 42.9722 0.7649 73.2548 57.2244 2.4226 75.314 34.6826 19.1287 70.6149 70.4115 33.9217 81.5089 37.2083 66.534 89.3452 91.5834 2.5328 30.6971 27.46 74.5105 44.4221 51.1797 25.7589 53.0763 80.5019 52.215 85.4901 25.8338 85.5443 91.6352 30.7413 74.5578 95.2246 77.6401 56.1242 56.2078 27.358 87.2828 71.0197 35.0532 99.3252 90.2078 33.7375 28.8568 22.1256 10.5862 56.4477 3.3707 87.8635 65.7163 59.5875 49.7937 18.2347 0.0226 49.3379 15.9653 61.2468 77.0689 22.1559 13.7667 82.2701 8.0509 36.4116 46.1478 21.132 27.7989 62.9766 31.2798 77.6667 69.5378 30.2085 87.7294 35.5495 27.635 33.9534 41.9007 46.5582 1.4854 39.485 38.2511 5.9347 99.569 95.4564 42.9635 39.3049 70.2403 10.2768 32.3768 49.3216 46.088 70.6772 39.1745 53.1362 36.5755 79.0159 16.7573 69.7563 71.5171 16.1587 53.2436 48.6424 97.609 80.7874 15.0492 2.4984 23.3211 21.3807 21.5142 79.3968 22.0998 9.5575 17.0914 8.2214 83.69 53.2317 89.3432 52.4236 26.6115 44.5725 58.6362 87.3395 1.2158 95.5258 97.9268 38.5166 30.3236 68.4699 27.4363 20.1875 47.9508 99.7208 9.714 97.5806 72.742 53.5318 4.7985 17.7516 41.8748 4.1203 49.3049 60.1929 6.6524 84.2503 40.5573 54.1542 8.8631 84.2703 78.8801 95.7521 28.1228 21.7445 39.4883 78.214 69.7188 94.3939 63.6665 22.0461 91.7497 33.2603 97.9761 85.1444 36.206 86.2993 56.2235 65.5986 58.153 76.679 79.8559 34.2373 29.7566 11.2177 91.2211 87.4635 7.0904 78.9452 36.2678 32.232 72.2087 69.5714 69.4798 76.8783 98.1917 6.0473 39.386 16.9462 16.7906 54.4506 47.3426 19.3348 32.3245 87.0887 71.9709 86.4367 21.8943 66.2186 44.5224 19.3908 58.7037 89.3168 35.8975 86.5467 35.4346 19.2986 30.7729 92.6903 10.094 99.6444 92.8037 44.5898 46.5646 87.7268 10.7223 2.0743 4.7134 57.3391 87.3038 48.784 5.5921 0.0083 49.949 16.5036 43.8025 41.9565 62.6712 5.6888 6.3026 88.0344 5.333 49.273 78.3582 68.075 25.7673 50.8146 82.1584 73.6609 39.3363 10.5179 0.2546 70.5143 96.5596 70.4476 44.9804 58.2842 66.4524 1.6465 35.2575 89.4311 47.9865 50.845 14.9417 96.9974 92.2375 92.6376 46.506 51.2538 47.7565 92.7304 78.5774 80.0152 87.4904 59.9291 12.0064 22.9004 15.3683 0.337 79.6941 80.2272 69.6739 50.1233 53.9414 0.4168 94.9117 60.3634 5.7533 63.2949 68.829 9.9896 62.4909 98.0062 68.7062 46.8603 76.0441 31.7659 37.5099 76.1628 6.6963 32.0529 44.108 66.2119 58.5778 24.5771 30.1642 64.6236 54.9053 25.1777 22.2377 99.8781 6.609 92.6771 74.8929 32.436 1.8898 75.6503 75.0837 7.6843 32.2335 44.7932 54.1101 17.733 75.4088 79.7282 10.6491 10.6656 3.278 93.1337 10.6668 84.5591 65.0415 76.1602 35.9422 96.9798 32.5127 49.5118 58.8135 44.1064 87.7835 36.3313 1.0318 49.0234 69.4881 29.5419 96.0541 54.1632 60.7814 36.961 78.3007 36.1187 59.5573 57.6946 78.6297 26.1671 88.158 45.7621 15.6332 58.1365 78.2357 18.2989 19.1753 5.7988 71.5821 23.653 7.3844 97.3915 31.9588 4.5872 9.0565 14.783 1.2796 63.2001 89.9138 21.5602 33.25 99.4615 43.8823 78.1343 10.2783 45.9408 28.671 58.4837 21.0206 65.1025 60.5847 59.4479 33.0687 69.145 73.4219 25.5068 80.1585 92.9454 31.938 81.8458 76.4002 92.1646 49.3534 94.2665 26.8124 14.4437 81.9556 44.0083 98.488 97.9071 60.3971 5.6291 98.0932 63.7722 4.8087 98.3172 53.9298 26.101 12.3481 38.0239 3.9596 89.3349 99.9583 71.3772 75.8904 72.398 45.6231 45.6591 91.865 13.3253 55.3985 39.8291 76.9544 64.9983 11.8039 41.3183 44.1376 80.3205 87.2896 7.5188 98.0244 96.0128 93.0405 56.0218 21.439 58.3194 82.1969 65.2225 17.5901 2.5231 38.553 56.9138 25.1303 24.3264 52.1661 35.572 19.8555 2.8892 34.4264 0.5563 33.7663 27.7917 88.8043 47.1741 70.3692 71.762 21.5324 11.0786 56.1433 53.4819 67.7389 19.5828 37.1512 21.5725 86.3702 73.9943 28.7636 16.0322 75.1789 6.2145 56.2225 59.6037 13.7298 75.1528 36.5139 5.4185 21.8924 8.1222 42.8671 89.0368 90.9542 85.749 42.6814 15.9999 68.2146 7.0713 81.6559 17.5732 90.964 87.7486 36.7213 96.2159 60.1037 59.8347 6.6457 46.7052 23.2189 34.8067 55.9454 35.2054 83.3514 39.2489 90.2958 41.4947 86.1403 91.6142 94.1592 87.3175 41.1974 91.3693 51.8228 3.6866 35.8065 90.3849 65.4704 38.3558 78.102 19.4308 25.5467 25.8809
    ${output}=    Read Until Prompt
    Log    ${output}
    ${CmdComplete}=    Get Line    ${output}    -2
    Should Match Regexp    ${CmdComplete}    (=== \\[waitForCompletion_${component}\\] command )[0-9]+( timed out :)

Start Controller
    [Tags]    functional
    Switch Connection    Controller
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/cpp/src
    Comment    Start Controller.
    ${input}=    Write    ./sacpp_${subSystem}_${component}_controller
    ${output}=    Read Until    controller ready
    Log    ${output}
    Should Contain    ${output}    ${subSystem}_${component} controller ready

Start Commander
    [Tags]    functional
    Switch Connection    Commander
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/cpp/src
    Comment    Start Commander.
    ${input}=    Write    ./sacpp_${subSystem}_${component}_commander 64.7156 1.1866 23.3254 58.8797 57.7212 26.7794 35.1605 16.3639 55.4776 64.6297 67.3322 61.1595 12.959 88.9673 37.3283 2.748 18.3696 94.5707 56.9031 40.2542 82.547 9.0201 3.1041 53.621 50.826 94.6301 10.4961 72.4299 99.8942 42.9722 0.7649 73.2548 57.2244 2.4226 75.314 34.6826 19.1287 70.6149 70.4115 33.9217 81.5089 37.2083 66.534 89.3452 91.5834 2.5328 30.6971 27.46 74.5105 44.4221 51.1797 25.7589 53.0763 80.5019 52.215 85.4901 25.8338 85.5443 91.6352 30.7413 74.5578 95.2246 77.6401 56.1242 56.2078 27.358 87.2828 71.0197 35.0532 99.3252 90.2078 33.7375 28.8568 22.1256 10.5862 56.4477 3.3707 87.8635 65.7163 59.5875 49.7937 18.2347 0.0226 49.3379 15.9653 61.2468 77.0689 22.1559 13.7667 82.2701 8.0509 36.4116 46.1478 21.132 27.7989 62.9766 31.2798 77.6667 69.5378 30.2085 87.7294 35.5495 27.635 33.9534 41.9007 46.5582 1.4854 39.485 38.2511 5.9347 99.569 95.4564 42.9635 39.3049 70.2403 10.2768 32.3768 49.3216 46.088 70.6772 39.1745 53.1362 36.5755 79.0159 16.7573 69.7563 71.5171 16.1587 53.2436 48.6424 97.609 80.7874 15.0492 2.4984 23.3211 21.3807 21.5142 79.3968 22.0998 9.5575 17.0914 8.2214 83.69 53.2317 89.3432 52.4236 26.6115 44.5725 58.6362 87.3395 1.2158 95.5258 97.9268 38.5166 30.3236 68.4699 27.4363 20.1875 47.9508 99.7208 9.714 97.5806 72.742 53.5318 4.7985 17.7516 41.8748 4.1203 49.3049 60.1929 6.6524 84.2503 40.5573 54.1542 8.8631 84.2703 78.8801 95.7521 28.1228 21.7445 39.4883 78.214 69.7188 94.3939 63.6665 22.0461 91.7497 33.2603 97.9761 85.1444 36.206 86.2993 56.2235 65.5986 58.153 76.679 79.8559 34.2373 29.7566 11.2177 91.2211 87.4635 7.0904 78.9452 36.2678 32.232 72.2087 69.5714 69.4798 76.8783 98.1917 6.0473 39.386 16.9462 16.7906 54.4506 47.3426 19.3348 32.3245 87.0887 71.9709 86.4367 21.8943 66.2186 44.5224 19.3908 58.7037 89.3168 35.8975 86.5467 35.4346 19.2986 30.7729 92.6903 10.094 99.6444 92.8037 44.5898 46.5646 87.7268 10.7223 2.0743 4.7134 57.3391 87.3038 48.784 5.5921 0.0083 49.949 16.5036 43.8025 41.9565 62.6712 5.6888 6.3026 88.0344 5.333 49.273 78.3582 68.075 25.7673 50.8146 82.1584 73.6609 39.3363 10.5179 0.2546 70.5143 96.5596 70.4476 44.9804 58.2842 66.4524 1.6465 35.2575 89.4311 47.9865 50.845 14.9417 96.9974 92.2375 92.6376 46.506 51.2538 47.7565 92.7304 78.5774 80.0152 87.4904 59.9291 12.0064 22.9004 15.3683 0.337 79.6941 80.2272 69.6739 50.1233 53.9414 0.4168 94.9117 60.3634 5.7533 63.2949 68.829 9.9896 62.4909 98.0062 68.7062 46.8603 76.0441 31.7659 37.5099 76.1628 6.6963 32.0529 44.108 66.2119 58.5778 24.5771 30.1642 64.6236 54.9053 25.1777 22.2377 99.8781 6.609 92.6771 74.8929 32.436 1.8898 75.6503 75.0837 7.6843 32.2335 44.7932 54.1101 17.733 75.4088 79.7282 10.6491 10.6656 3.278 93.1337 10.6668 84.5591 65.0415 76.1602 35.9422 96.9798 32.5127 49.5118 58.8135 44.1064 87.7835 36.3313 1.0318 49.0234 69.4881 29.5419 96.0541 54.1632 60.7814 36.961 78.3007 36.1187 59.5573 57.6946 78.6297 26.1671 88.158 45.7621 15.6332 58.1365 78.2357 18.2989 19.1753 5.7988 71.5821 23.653 7.3844 97.3915 31.9588 4.5872 9.0565 14.783 1.2796 63.2001 89.9138 21.5602 33.25 99.4615 43.8823 78.1343 10.2783 45.9408 28.671 58.4837 21.0206 65.1025 60.5847 59.4479 33.0687 69.145 73.4219 25.5068 80.1585 92.9454 31.938 81.8458 76.4002 92.1646 49.3534 94.2665 26.8124 14.4437 81.9556 44.0083 98.488 97.9071 60.3971 5.6291 98.0932 63.7722 4.8087 98.3172 53.9298 26.101 12.3481 38.0239 3.9596 89.3349 99.9583 71.3772 75.8904 72.398 45.6231 45.6591 91.865 13.3253 55.3985 39.8291 76.9544 64.9983 11.8039 41.3183 44.1376 80.3205 87.2896 7.5188 98.0244 96.0128 93.0405 56.0218 21.439 58.3194 82.1969 65.2225 17.5901 2.5231 38.553 56.9138 25.1303 24.3264 52.1661 35.572 19.8555 2.8892 34.4264 0.5563 33.7663 27.7917 88.8043 47.1741 70.3692 71.762 21.5324 11.0786 56.1433 53.4819 67.7389 19.5828 37.1512 21.5725 86.3702 73.9943 28.7636 16.0322 75.1789 6.2145 56.2225 59.6037 13.7298 75.1528 36.5139 5.4185 21.8924 8.1222 42.8671 89.0368 90.9542 85.749 42.6814 15.9999 68.2146 7.0713 81.6559 17.5732 90.964 87.7486 36.7213 96.2159 60.1037 59.8347 6.6457 46.7052 23.2189 34.8067 55.9454 35.2054 83.3514 39.2489 90.2958 41.4947 86.1403 91.6142 94.1592 87.3175 41.1974 91.3693 51.8228 3.6866 35.8065 90.3849 65.4704 38.3558 78.102 19.4308 25.5467 25.8809
    ${output}=    Read Until Prompt
    Log    ${output}
    Should Contain X Times    ${output}    === [issueCommand_${component}] writing a command containing :    1
    Should Contain X Times    ${output}    device : target    1
    Should Contain X Times    ${output}    property : lut    1
    Should Contain X Times    ${output}    action :     1
    Should Contain X Times    ${output}    value :     1
    Should Contain X Times    ${output}    xlut : 64.7156    1
    Should Contain X Times    ${output}    ylut : 1.1866    1
    Should Contain X Times    ${output}    zlut : 23.3254    1
    Should Contain X Times    ${output}    ulut : 58.8797    1
    Should Contain X Times    ${output}    vlut : 57.7212    1
    Should Contain X Times    ${output}    wlut : 26.7794    1
    Should Contain    ${output}    === command configureLut issued =
    ${CmdComplete}=    Get Line    ${output}    -2
    Should Match Regexp    ${CmdComplete}    (=== \\[waitForCompletion_${component}\\] command )[0-9]+( timed out :)

Read Controller
    [Tags]    functional
    Switch Connection    Controller
    ${output}=    Read Until    result \ \ : Done : OK
    Log    ${output}
    Should Contain    ${output}    === command configureLut received =
    Should Contain    ${output}    device : target
    Should Contain    ${output}    property : lut
    Should Contain    ${output}    action : 
    Should Contain    ${output}    value : 
    Should Contain X Times    ${output}    xlut : 64.7156    1
    Should Contain X Times    ${output}    ylut : 8.0509    1
    Should Contain X Times    ${output}    zlut : 39.4883    1
    Should Contain X Times    ${output}    ulut : 44.9804    1
    Should Contain X Times    ${output}    vlut : 96.0541    1
    Should Contain X Times    ${output}    wlut : 98.0244    1
    Should Contain X Times    ${output}    === [ackCommand_configureLut] acknowledging a command with :    2
    Should Contain    ${output}    seqNum   :
    Should Contain    ${output}    ack      : 301
    Should Contain X Times    ${output}    error \ \ \ : 0    2
    Should Contain    ${output}    result   : Ack : OK
    Should Contain    ${output}    ack      : 303
    Should Contain    ${output}    result   : Done : OK
