*** Settings ***
Documentation    Hexapod_configureLut commander/controller tests.
Suite Setup    Log Many    ${Host}    ${subSystem}    ${component}    ${timeout}
Suite Teardown    Close All Connections
Library    SSHLibrary
Library    String
Resource    ../../Global_Vars.robot

*** Variables ***
${subSystem}    hexapod
${component}    configureLut
${timeout}    30s

*** Test Cases ***
Create Commander Session
    [Documentation]    Connect to the SAL host.
    [Tags]    smoke
    Comment    Connect to host.
    Open Connection    host=${Host}    alias=Commander    timeout=${timeout}    prompt=${Prompt}
    Comment    Login.
    Log    ${ContInt}
    Run Keyword If    "${ContInt}"=="false"    Login    ${UserName}    ${PassWord}
    Run Keyword If    "${ContInt}"=="true"    Login With Public Key    ${UserName}    keyfile=${PassWord}
    Directory Should Exist    ${SALInstall}
    Directory Should Exist    ${SALHome}
    Directory Should Exist    ${SALWorkDir}/${subSystem}

Create Controller Session
    [Documentation]    Connect to the SAL host.
    [Tags]    smoke
    Comment    Connect to host.
    Open Connection    host=${Host}    alias=Controller    timeout=${timeout}    prompt=${Prompt}
    Comment    Login.
    Log    ${ContInt}
    Run Keyword If    "${ContInt}"=="false"    Login    ${UserName}    ${PassWord}
    Run Keyword If    "${ContInt}"=="true"    Login With Public Key    ${UserName}    keyfile=${PassWord}
    Directory Should Exist    ${SALInstall}
    Directory Should Exist    ${SALHome}
    Directory Should Exist    ${SALWorkDir}/${subSystem}

Verify Component Commander and Controller
    [Tags]    smoke
    File Should Exist    ${SALWorkDir}/${subSystem}/cpp/src/sacpp_${subSystem}_${component}_commander
    File Should Exist    ${SALWorkDir}/${subSystem}/cpp/src/sacpp_${subSystem}_${component}_controller

Start Commander - Verify Missing Inputs Error
    [Tags]    functional
    Switch Connection    Commander
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/cpp/src
    Comment    Start Commander.
    ${input}=    Write    ./sacpp_${subSystem}_${component}_commander 
    ${output}=    Read Until Prompt
    Log    ${output}
    Should Contain    ${output}   Usage : \ input parameters...

Start Commander - Verify Timeout without Controller
    [Tags]    functional
    Switch Connection    Commander
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/cpp/src
    Comment    Start Commander.
    ${input}=    Write    ./sacpp_${subSystem}_${component}_commander 69.427 76.6391 13.7628 76.3559 26.0434 16.4054 62.6643 20.3213 21.9662 38.6669 72.0367 60.5728 4.1322 90.3203 79.8969 18.3903 71.9459 10.7665 89.9038 65.3575 87.216 29.6552 56.2368 92.6142 45.1386 83.0455 73.9071 93.9592 43.6009 1.1632 17.8522 15.3082 38.1429 79.0305 62.4151 42.017 75.3661 36.697 91.8879 75.6201 35.7442 32.1687 17.5157 86.2613 73.7438 7.99 81.1093 98.8896 86.2073 89.0258 59.0455 79.6747 37.1244 86.4984 67.5768 58.9065 6.7796 0.8934 21.247 9.8494 63.8259 71.593 20.2382 58.626 65.6141 29.2972 39.4022 79.4161 22.1535 49.9778 76.0282 53.0815 62.1113 34.1618 63.0128 90.7814 93.0686 27.0804 30.3287 4.3739 9.1648 1.33 1.086 91.0276 62.3186 47.3967 1.7259 22.2248 17.4059 85.0432 72.8676 6.2423 12.6865 59.6902 63.8144 39.0 78.4696 63.1302 40.1307 62.4715 66.6261 46.4057 30.0099 20.0704 66.8168 6.1952 88.4664 79.5447 31.9412 63.2836 8.9377 74.8374 53.5919 57.3608 55.9851 39.6767 52.0091 34.9718 13.3931 35.8903 70.7356 21.8459 79.7068 53.742 89.8529 41.1088 20.4216 31.8008 25.4865 43.0857 8.1692 23.9487 90.8721 10.1845 63.8723 97.6573 94.4107 14.4627 23.9207 28.5984 60.5753 59.6662 75.9071 0.8917 22.4419 40.6195 13.8936 73.1256 95.8773 40.4484 28.0311 48.2735 40.9922 53.7733 55.6721 30.7646 82.0647 14.699 56.8084 4.4654 35.405 7.391 87.9754 61.219 57.0335 28.1112 68.9114 84.8082 4.3162 35.7604 41.3397 66.2542 84.5055 23.5042 20.687 24.6958 60.4767 54.0766 23.0735 25.7518 38.9922 8.5669 88.7998 55.7384 46.4714 93.4042 30.6945 43.7401 80.5374 84.0769 19.2553 22.3245 11.6201 68.4558 11.5579 42.1485 8.4027 95.1209 11.6509 25.8748 76.5757 80.3111 34.7664 61.1672 71.2697 33.7417 95.5088 97.5274 99.6215 78.5471 35.3341 12.4828 32.863 85.8535 49.1599 89.0342 3.2945 50.2374 45.6224 30.7123 83.1486 81.79 30.1714 65.8933 71.5656 36.0766 81.4912 43.5085 36.8643 4.0813 88.3991 45.1199 11.7626 76.4159 84.4227 97.2345 6.4822 94.1776 74.6703 41.009 85.7408 81.7842 54.49 32.4004 80.3922 99.0854 11.6196 24.4393 69.6542 30.3431 5.2545 82.4799 33.5034 7.8793 2.7813 34.9082 76.0916 9.1427 87.2726 18.2785 58.2473 32.0938 7.5605 70.1954 73.2354 74.031 66.6481 58.0041 8.7289 90.0457 75.8876 42.5115 53.9645 70.9863 68.3539 12.5199 35.9864 36.9528 72.9622 70.028 15.7952 37.1641 59.205 44.0518 83.1105 53.9086 84.5237 38.249 59.9297 9.9692 49.2507 44.5558 18.5577 87.3728 45.9614 10.6503 59.398 42.5427 17.7393 92.9068 76.8953 79.8301 17.5398 78.844 24.1083 47.8101 59.6318 21.0916 92.1201 34.8727 64.9492 22.0537 21.9593 72.7023 36.5067 37.2592 20.8631 96.015 32.9593 24.3428 32.6427 68.0665 70.1311 43.9278 25.6804 53.2584 38.7 38.9193 55.1415 37.8332 39.8987 27.4088 91.5205 9.6167 79.0997 0.4102 23.0572 89.8176 64.232 6.8313 94.805 49.1323 89.5609 38.4696 72.5332 4.6968 45.5061 14.5943 36.8647 19.8419 99.2391 9.9492 27.5034 12.047 42.1416 75.8788 29.4392 27.5884 30.6014 21.4886 29.4839 6.1455 80.5029 51.9513 76.3862 92.4357 17.8543 38.9897 27.1334 37.9833 6.433 11.3032 23.5358 24.0448 7.9433 50.8754 72.7432 26.6342 48.4314 21.4906 49.4981 97.0476 97.845 76.6768 24.4405 43.3737 6.5257 27.5814 51.3087 12.6028 58.5698 11.0156 40.5112 43.5092 26.8606 98.344 83.8112 88.317 79.761 13.8522 39.2871 7.2086 42.7416 89.1464 95.3907 39.9879 41.5295 75.3537 84.5533 53.1628 73.226 23.6382 51.5604 72.5673 87.4824 65.5248 69.9572 31.6968 47.6804 1.359 31.6225 36.6637 61.5999 29.3009 61.2606 77.7183 36.3655 45.9489 0.7794 40.1057 51.2382 63.7866 16.7153 28.1472 69.9958 10.2221 62.4898 47.9218 42.9306 26.9632 36.0714 19.527 0.8493 78.2209 35.9669 89.6289 1.6718 23.9949 47.4417 87.0444 8.4439 30.0177 53.8886 13.5709 66.8326 55.9416 32.7228 80.8958 19.1153 38.4853 91.389 67.4174 1.8759 38.3467 33.949 72.9053 41.3234 87.1485 17.9414 70.4071 85.3959 81.4263 21.2403 10.6535 35.8827 3.2284 27.5389 27.2142 52.3119 52.2366 91.4318 39.8517 88.7915 4.0888 7.4314 67.5362 21.5244 57.0354 26.5136 92.9146 48.6229 94.8714 34.0089 6.8669 21.5883 89.8894 73.6429 89.6115 58.6647 4.6313 92.7969 2.1314 42.6672 99.8603 2.6666 92.4729 51.8086 13.5 60.3394 71.0953 36.6145 33.9585 32.8038 84.7301 88.5706 99.101 78.6123 44.4755 91.1043 93.1967 60.7494 80.7075 95.9739 5.0277 75.7624 13.2398 50.2949 68.8173 44.6781 44.8076 37.9923 83.4767 45.8838 59.742 55.6574 94.8023 16.7589 55.3255 32.6547 74.4408
    ${output}=    Read Until Prompt
    Log    ${output}
    ${CmdComplete}=    Get Line    ${output}    -2
    Should Match Regexp    ${CmdComplete}    (=== \\[waitForCompletion_${component}\\] command )[0-9]+( timed out :)

Start Controller
    [Tags]    functional
    Switch Connection    Controller
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/cpp/src
    Comment    Start Controller.
    ${input}=    Write    ./sacpp_${subSystem}_${component}_controller
    ${output}=    Read Until    controller ready
    Log    ${output}
    Should Contain    ${output}    ${subSystem}_${component} controller ready

Start Commander
    [Tags]    functional
    Switch Connection    Commander
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/cpp/src
    Comment    Start Commander.
    ${input}=    Write    ./sacpp_${subSystem}_${component}_commander 69.427 76.6391 13.7628 76.3559 26.0434 16.4054 62.6643 20.3213 21.9662 38.6669 72.0367 60.5728 4.1322 90.3203 79.8969 18.3903 71.9459 10.7665 89.9038 65.3575 87.216 29.6552 56.2368 92.6142 45.1386 83.0455 73.9071 93.9592 43.6009 1.1632 17.8522 15.3082 38.1429 79.0305 62.4151 42.017 75.3661 36.697 91.8879 75.6201 35.7442 32.1687 17.5157 86.2613 73.7438 7.99 81.1093 98.8896 86.2073 89.0258 59.0455 79.6747 37.1244 86.4984 67.5768 58.9065 6.7796 0.8934 21.247 9.8494 63.8259 71.593 20.2382 58.626 65.6141 29.2972 39.4022 79.4161 22.1535 49.9778 76.0282 53.0815 62.1113 34.1618 63.0128 90.7814 93.0686 27.0804 30.3287 4.3739 9.1648 1.33 1.086 91.0276 62.3186 47.3967 1.7259 22.2248 17.4059 85.0432 72.8676 6.2423 12.6865 59.6902 63.8144 39.0 78.4696 63.1302 40.1307 62.4715 66.6261 46.4057 30.0099 20.0704 66.8168 6.1952 88.4664 79.5447 31.9412 63.2836 8.9377 74.8374 53.5919 57.3608 55.9851 39.6767 52.0091 34.9718 13.3931 35.8903 70.7356 21.8459 79.7068 53.742 89.8529 41.1088 20.4216 31.8008 25.4865 43.0857 8.1692 23.9487 90.8721 10.1845 63.8723 97.6573 94.4107 14.4627 23.9207 28.5984 60.5753 59.6662 75.9071 0.8917 22.4419 40.6195 13.8936 73.1256 95.8773 40.4484 28.0311 48.2735 40.9922 53.7733 55.6721 30.7646 82.0647 14.699 56.8084 4.4654 35.405 7.391 87.9754 61.219 57.0335 28.1112 68.9114 84.8082 4.3162 35.7604 41.3397 66.2542 84.5055 23.5042 20.687 24.6958 60.4767 54.0766 23.0735 25.7518 38.9922 8.5669 88.7998 55.7384 46.4714 93.4042 30.6945 43.7401 80.5374 84.0769 19.2553 22.3245 11.6201 68.4558 11.5579 42.1485 8.4027 95.1209 11.6509 25.8748 76.5757 80.3111 34.7664 61.1672 71.2697 33.7417 95.5088 97.5274 99.6215 78.5471 35.3341 12.4828 32.863 85.8535 49.1599 89.0342 3.2945 50.2374 45.6224 30.7123 83.1486 81.79 30.1714 65.8933 71.5656 36.0766 81.4912 43.5085 36.8643 4.0813 88.3991 45.1199 11.7626 76.4159 84.4227 97.2345 6.4822 94.1776 74.6703 41.009 85.7408 81.7842 54.49 32.4004 80.3922 99.0854 11.6196 24.4393 69.6542 30.3431 5.2545 82.4799 33.5034 7.8793 2.7813 34.9082 76.0916 9.1427 87.2726 18.2785 58.2473 32.0938 7.5605 70.1954 73.2354 74.031 66.6481 58.0041 8.7289 90.0457 75.8876 42.5115 53.9645 70.9863 68.3539 12.5199 35.9864 36.9528 72.9622 70.028 15.7952 37.1641 59.205 44.0518 83.1105 53.9086 84.5237 38.249 59.9297 9.9692 49.2507 44.5558 18.5577 87.3728 45.9614 10.6503 59.398 42.5427 17.7393 92.9068 76.8953 79.8301 17.5398 78.844 24.1083 47.8101 59.6318 21.0916 92.1201 34.8727 64.9492 22.0537 21.9593 72.7023 36.5067 37.2592 20.8631 96.015 32.9593 24.3428 32.6427 68.0665 70.1311 43.9278 25.6804 53.2584 38.7 38.9193 55.1415 37.8332 39.8987 27.4088 91.5205 9.6167 79.0997 0.4102 23.0572 89.8176 64.232 6.8313 94.805 49.1323 89.5609 38.4696 72.5332 4.6968 45.5061 14.5943 36.8647 19.8419 99.2391 9.9492 27.5034 12.047 42.1416 75.8788 29.4392 27.5884 30.6014 21.4886 29.4839 6.1455 80.5029 51.9513 76.3862 92.4357 17.8543 38.9897 27.1334 37.9833 6.433 11.3032 23.5358 24.0448 7.9433 50.8754 72.7432 26.6342 48.4314 21.4906 49.4981 97.0476 97.845 76.6768 24.4405 43.3737 6.5257 27.5814 51.3087 12.6028 58.5698 11.0156 40.5112 43.5092 26.8606 98.344 83.8112 88.317 79.761 13.8522 39.2871 7.2086 42.7416 89.1464 95.3907 39.9879 41.5295 75.3537 84.5533 53.1628 73.226 23.6382 51.5604 72.5673 87.4824 65.5248 69.9572 31.6968 47.6804 1.359 31.6225 36.6637 61.5999 29.3009 61.2606 77.7183 36.3655 45.9489 0.7794 40.1057 51.2382 63.7866 16.7153 28.1472 69.9958 10.2221 62.4898 47.9218 42.9306 26.9632 36.0714 19.527 0.8493 78.2209 35.9669 89.6289 1.6718 23.9949 47.4417 87.0444 8.4439 30.0177 53.8886 13.5709 66.8326 55.9416 32.7228 80.8958 19.1153 38.4853 91.389 67.4174 1.8759 38.3467 33.949 72.9053 41.3234 87.1485 17.9414 70.4071 85.3959 81.4263 21.2403 10.6535 35.8827 3.2284 27.5389 27.2142 52.3119 52.2366 91.4318 39.8517 88.7915 4.0888 7.4314 67.5362 21.5244 57.0354 26.5136 92.9146 48.6229 94.8714 34.0089 6.8669 21.5883 89.8894 73.6429 89.6115 58.6647 4.6313 92.7969 2.1314 42.6672 99.8603 2.6666 92.4729 51.8086 13.5 60.3394 71.0953 36.6145 33.9585 32.8038 84.7301 88.5706 99.101 78.6123 44.4755 91.1043 93.1967 60.7494 80.7075 95.9739 5.0277 75.7624 13.2398 50.2949 68.8173 44.6781 44.8076 37.9923 83.4767 45.8838 59.742 55.6574 94.8023 16.7589 55.3255 32.6547 74.4408
    ${output}=    Read Until Prompt
    Log    ${output}
    Should Contain X Times    ${output}    === [issueCommand_${component}] writing a command containing :    1
    Should Contain X Times    ${output}    device : target    1
    Should Contain X Times    ${output}    property : lut    1
    Should Contain X Times    ${output}    action :     1
    Should Contain X Times    ${output}    value :     1
    Should Contain X Times    ${output}    xlut : 69.427    1
    Should Contain X Times    ${output}    ylut : 76.6391    1
    Should Contain X Times    ${output}    zlut : 13.7628    1
    Should Contain X Times    ${output}    ulut : 76.3559    1
    Should Contain X Times    ${output}    vlut : 26.0434    1
    Should Contain X Times    ${output}    wlut : 16.4054    1
    Should Contain    ${output}    === command configureLut issued =
    ${CmdComplete}=    Get Line    ${output}    -2
    Should Match Regexp    ${CmdComplete}    (=== \\[waitForCompletion_${component}\\] command )[0-9]+( completed ok :)

Read Controller
    [Tags]    functional
    Switch Connection    Controller
    ${output}=    Read Until    result \ \ : Done : OK
    Log    ${output}
    Should Contain    ${output}    === command configureLut received =
    Should Contain    ${output}    device : target
    Should Contain    ${output}    property : lut
    Should Contain    ${output}    action : 
    Should Contain    ${output}    value : 
    Should Contain X Times    ${output}    xlut : 69.427    1
    Should Contain X Times    ${output}    ylut : 72.8676    1
    Should Contain X Times    ${output}    zlut : 38.9922    1
    Should Contain X Times    ${output}    ulut : 75.8876    1
    Should Contain X Times    ${output}    vlut : 29.4839    1
    Should Contain X Times    ${output}    wlut : 8.4439    1
    Should Contain X Times    ${output}    === [ackCommand_configureLut] acknowledging a command with :    2
    Should Contain    ${output}    seqNum   :
    Should Contain    ${output}    ack      : 301
    Should Contain X Times    ${output}    error \ \ \ : 0    2
    Should Contain    ${output}    result   : Ack : OK
    Should Contain    ${output}    ack      : 303
    Should Contain    ${output}    result   : Done : OK
