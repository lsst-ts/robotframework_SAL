*** Settings ***
Documentation    M1M3_RejectedCylinderForces sender/logger tests.
Force Tags    python    TSS-2617
Suite Setup    Run Keywords    Log Many    ${Host}    ${subSystem}    ${component}    ${timeout}
...    AND    Create Session    Sender    AND    Create Session    Logger
Suite Teardown    Close All Connections
Library    SSHLibrary
Library    String
Resource    ../../Global_Vars.robot
Resource    ../../common.robot

*** Variables ***
${subSystem}    m1m3
${component}    RejectedCylinderForces
${timeout}    30s

*** Test Cases ***
Verify Component Sender and Logger
    [Tags]    smoke
    File Should Exist    ${SALWorkDir}/${subSystem}/python/${subSystem}_Event_${component}.py
    File Should Exist    ${SALWorkDir}/${subSystem}/python/${subSystem}_EventLogger_${component}.py

Start Sender - Verify Missing Inputs Error
    [Tags]    functional
    Switch Connection    Sender
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/python
    Comment    Start Sender.
    ${input}=    Write    python ${subSystem}_Event_${component}.py 
    ${output}=    Read Until Prompt
    Log    ${output}
    Should Contain    ${output}   ERROR : Invalid or missing arguments : Timestamp SecondaryCylinderForces PrimaryCylinderForces priority

Start Logger
    [Tags]    functional
    Switch Connection    Logger
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/python
    Comment    Start Logger.
    ${input}=    Write    python ${subSystem}_EventLogger_${component}.py
    ${output}=    Read Until    logger ready
    Log    ${output}
    Should Contain    ${output}    ${subSystem}_${component} logger ready

Start Sender
    [Tags]    functional
    Switch Connection    Sender
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/python
    Comment    Start Sender.
    ${input}=    Write    python ${subSystem}_Event_${component}.py 58.151 531597592 1703817381 -92120241 -961743619 -467197214 1145442369 1425719572 329875521 1411739726 -1136634068 -594262690 1127522457 -378652118 2118981441 -993616321 -1514751630 -233007210 -1443600329 1986906147 -1469421087 -892060270 441507317 1548188600 708745006 -1109067606 648984621 1782050448 1515634330 1568711865 485322094 -656536776 -949194868 50899712 1089539354 -1761975307 -1336607192 -1414339504 -114504421 1859277992 -1026493752 -967140511 -574263160 904579338 -1912297467 -2012549875 931841571 -1198271312 -412181805 -383843303 445576556 1459315897 -1670108122 -1764185165 8366156 329152103 1130037965 1618986172 2087817640 -650890583 -705953307 1452647205 387541476 685774037 -1279265273 289741406 -1845365122 1882574001 -1574485978 -346041830 -199486867 -2107762358 1411103875 215099760 1613525624 -232924828 -2133547139 1095263210 1196441544 646207036 45175857 23928210 1139645421 225785892 717669566 -1526985039 -1972517341 2084729493 1078267299 1297664996 1819602543 1606495054 889721174 -1425980594 385929512 -572375039 -1955281943 -2036867253 134804151 627299500 -1596982358 -694068168 -537123210 1480645936 -1979826825 1216898444 1892329990 838961110 76664799 -1579720686 -1051960997 -860261664 817265327 89518219 1336956159 972079958 -1628767030 1837573402 1541995580 1188567953 -492267602 599460073 -277563451 717349232 770288869 -2138544656 757981406 -1149910463 2028361493 439144285 -112000413 19202235 -623527120 938285999 914176044 1932645864 -397743950 -1052263813 1370052072 44301187 -179411936 -793932754 1767472195 -1108645942 1194789736 1423798997 -759333399 1019399874 1689024210 -358585227 -1166773945 -1785151707 1502142541 722013205 239933157 -1313627245 731392497 -1774859572 -1139523932 448334600 -1166599404 -708152210 -399698883 -1276870609 -1367576937 -1205888216 -1899047065 901632125 -1959670317 1355558216 -1106751677 1053792321 283157884 -2018861343 1453892214 -1068187421 -1724911543 -2146431882 -373562018 51123048 -788212560 326051445 455995563 -1671594249 -156844455 2067864095 888641147 277946493 1965660834 1317349647 1477539708 284266749 138291190 995285564 362159 -610698350 -1179128242 -497936469 -1336609785 -492568960 1127516799 880412057 1455123775 -1880113621 -1602678689 -967484744 1602589053 651365732 236396595 1325212302 1803112833 122147913 1119356801 354775837 1001734936 -736983384 818561664 571030976 -998313430 514344730 -1980993023 1236291829 246463117 340788199 79975854 1049536816 1880316507 -1927440083 -1150695085 1404243759 1597944762 -959337685 82420963 -1015749446 1566737555 1763492706 -1035871546 -1803349100 -323692212 1424811704 -1866437057 1317510404 837619402 -858785533 121090429 2090457022 -284748213 1616286935 -1575525545 -1929535485 -1801088518 1515484322 1460938406 -1182486205 1526433101 1169338812 1105019576 714045230 -347109664 758340206 2053657183 -519005921 299478590 1406660326 -1618882443 248788884 -147180182 -1597497599 333197647 -402533346
    ${output}=    Read Until Prompt
    Log    ${output}
    Should Contain X Times    ${output}    === [putSample] m1m3::logevent_RejectedCylinderForces writing a message containing :    1
    Should Contain    ${output}    revCode \ : LSST TEST REVCODE

Read Logger
    [Tags]    functional
    Switch Connection    Logger
    ${output}=    Read Until    ${component} received
    Log    ${output}
    Should Contain X Times    ${output}    Event ${subSystem} ${component} received     1
