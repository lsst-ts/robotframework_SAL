*** Settings ***
Documentation    M1M3_AppliedCylinderForces sender/logger tests.
Force Tags    python    TSS-2617
Suite Setup    Run Keywords    Log Many    ${Host}    ${subSystem}    ${component}    ${timeout}
...    AND    Create Session    Sender    AND    Create Session    Logger
Suite Teardown    Close All Connections
Library    SSHLibrary
Library    String
Resource    ../../Global_Vars.robot
Resource    ../../common.robot

*** Variables ***
${subSystem}    m1m3
${component}    AppliedCylinderForces
${timeout}    30s

*** Test Cases ***
Verify Component Sender and Logger
    [Tags]    smoke
    File Should Exist    ${SALWorkDir}/${subSystem}/python/${subSystem}_Event_${component}.py
    File Should Exist    ${SALWorkDir}/${subSystem}/python/${subSystem}_EventLogger_${component}.py

Start Sender - Verify Missing Inputs Error
    [Tags]    functional
    Switch Connection    Sender
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/python
    Comment    Start Sender.
    ${input}=    Write    python ${subSystem}_Event_${component}.py 
    ${output}=    Read Until Prompt
    Log    ${output}
    Should Contain    ${output}   ERROR : Invalid or missing arguments : Timestamp SecondaryCylinderForces PrimaryCylinderForces priority

Start Logger
    [Tags]    functional
    Switch Connection    Logger
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/python
    Comment    Start Logger.
    ${input}=    Write    python ${subSystem}_EventLogger_${component}.py
    ${output}=    Read Until    logger ready
    Log    ${output}
    Should Contain    ${output}    ${subSystem}_${component} logger ready

Start Sender
    [Tags]    functional
    Switch Connection    Sender
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/python
    Comment    Start Sender.
    ${input}=    Write    python ${subSystem}_Event_${component}.py 29.8543 -1069162510 -930482396 69917404 1781012415 2001491262 -588029013 1678675104 -1068168796 1263749747 904897634 825292576 867069242 -251933723 369789982 73496034 -716240571 1580639833 -88590814 1328859097 1344679261 -1202131652 -1110490763 923927035 312114335 359858841 1268063497 -440598034 1591413648 -994653129 141771123 1675784401 -839014203 145863267 -1131925459 -424918547 -1134168751 1507724374 -1140811383 -1647844681 2002990346 -530175106 1771933988 1156706151 -1113536596 1117566684 -739426135 -177301271 211092819 446711727 619646433 -861177476 75691519 -282052350 1790304942 1073120373 1371400253 490159422 -162042029 -1790709261 1857864809 -1522779396 -970593625 -459831351 945795209 -362668388 386027499 871733270 -799211249 489919355 -558752997 1648615063 -1383402932 1676087907 -1890004748 -1382652223 -112496377 -1028574599 -586706734 840378410 -1768730781 -1812422047 -827095124 1009768843 534247675 800264176 -1692061559 174064079 1424749750 1895407298 -241210256 -1866162971 1192800183 -645096904 2059785111 855241854 394918392 -552049667 -39951561 -1953828024 -692895146 -55718136 1382615832 -621445927 -1154602996 501892828 -1692191505 1421440598 -367709657 -824721412 909239937 2140226684 -1047484779 783108454 -727843352 -1759405146 -447987958 1043714745 -264869558 -1648616965 758649038 -1105124234 539325824 -981502607 -1173188952 351546705 1015926914 660449658 -460718636 672621874 1572455550 -924716396 -1433749397 -2091742354 -1143331579 1209416976 492601983 -525450949 514954184 -488681772 1376262506 734618909 -766710495 -862689458 -568992984 1847602940 1214782849 1867874840 -6812077 558048566 678056256 695111664 1312485014 401771862 1964276064 -905701889 1610543680 528713224 -1596359015 318614169 -841769459 400913037 -674878411 -398347606 327428724 1923329262 1025468782 18268444 453741065 1267260573 -988751428 1516652434 1042173690 -563848815 -1336433803 -19885044 -1946471414 -1792927898 -778449804 458620827 611958020 1599237512 1537826127 -936851003 1427857667 -1123803979 936437751 -2103917218 -466336902 174696552 766601364 545772571 129632983 149377141 -1677625139 -524404257 -1879916982 893737797 607654662 71729253 -1906215056 1941219683 -861807105 1852450931 209153304 771091955 -2029994598 1996479976 1341802503 1052156829 -153791308 -1527974877 -914630719 436650435 231114770 -1178956389 1418020925 -1290346725 148041066 -1754815194 -1689339000 -741938956 936069361 23419997 -1177177747 -1310628752 1626711671 -240142279 561659639 -412235865 987363018 1760022597 1022814826 914562832 -764621118 1647110688 -1917023153 -754426877 -145312932 -2145679960 873942528 1719562637 -911552021 996092789 118125991 2063000710 -1540773022 -1414601938 -318953549 260690059 -945247738 1575278878 1868221219 327481718 -1001695811 681980562 -852377337 -752297606 202466926 1006918312 1940817570 -1869841109 -155401928 969122299 1375063513 -275129963 -1966357730 889162462 1308174474 707352676
    ${output}=    Read Until Prompt
    Log    ${output}
    Should Contain X Times    ${output}    === [putSample] m1m3::logevent_AppliedCylinderForces writing a message containing :    1
    Should Contain    ${output}    revCode \ : LSST TEST REVCODE

Read Logger
    [Tags]    functional
    Switch Connection    Logger
    ${output}=    Read Until    ${component} received
    Log    ${output}
    Should Contain X Times    ${output}    Event ${subSystem} ${component} received     1
