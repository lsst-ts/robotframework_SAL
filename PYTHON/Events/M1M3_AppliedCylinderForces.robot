*** Settings ***
Documentation    M1M3_AppliedCylinderForces communications tests.
Force Tags    python    TSS-2617
Suite Setup    Run Keywords    Log Many    ${Host}    ${subSystem}    ${component}    ${timeout}
...    AND    Create Session    Sender    AND    Create Session    Logger
Suite Teardown    Close All Connections
Library    SSHLibrary
Library    String
Resource    ../../Global_Vars.robot
Resource    ../../common.robot

*** Variables ***
${subSystem}    m1m3
${component}    AppliedCylinderForces
${timeout}    30s

*** Test Cases ***
Verify Component Sender and Logger
    [Tags]    smoke
    File Should Exist    ${SALWorkDir}/${subSystem}/python/${subSystem}_Event_${component}.py
    File Should Exist    ${SALWorkDir}/${subSystem}/python/${subSystem}_EventLogger_${component}.py

Start Sender - Verify Missing Inputs Error
    [Tags]    functional
    Switch Connection    Sender
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/python
    Comment    Start Sender.
    ${input}=    Write    python ${subSystem}_Event_${component}.py 
    ${output}=    Read Until Prompt
    Log    ${output}
    Should Contain    ${output}   ERROR : Invalid or missing arguments : Timestamp SecondaryCylinderForces PrimaryCylinderForces priority

Start Logger
    [Tags]    functional
    Switch Connection    Logger
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/python
    Comment    Start Logger.
    ${input}=    Write    python ${subSystem}_EventLogger_${component}.py
    ${output}=    Read Until    logger ready
    Log    ${output}
    Should Contain    ${output}    ${subSystem}_${component} logger ready

Start Sender
    [Tags]    functional
    Switch Connection    Sender
    Comment    Move to working directory.
    Write    cd ${SALWorkDir}/${subSystem}/python
    Comment    Start Sender.
    ${input}=    Write    python ${subSystem}_Event_${component}.py 69.7878 -248404842 1187963739 -570935755 1042541618 121451007 -110912519 2116977260 1493023029 -1452840964 585180957 -480340720 -422128995 -353880193 -380804131 1407126942 731548286 92931929 1118871142 1425639287 -1713850751 -785525175 -1977230478 -187341350 -2140342390 779771598 -1665884286 -1995243712 -232519594 1863167510 282268631 782357289 1003905324 -111695450 -1285987189 -1948348081 -1355488947 1424861758 -2140798568 818230063 1383629009 -1205669343 -382415025 -1185720301 1679567481 1428052593 -773840505 -1350033251 -1581865347 -563294963 -76868156 -423765316 216398493 -2127669693 -492511068 -1217938886 -1798659185 -916347995 -1066254944 -1524138260 524513491 -1106889277 -613066519 -449335782 -153949717 -1683774123 1540211025 451703852 -495005195 -287145524 560044007 -643449848 2114710278 1107173776 -592079825 -1870587910 -1542383744 -1149871881 1209441300 -1132761598 -1595426068 -2060960598 -296468 -271105616 2081777492 -246764732 68272677 1728275107 1384930528 1350253594 -780687540 2074203269 768425743 466439949 2000991836 755812554 960005606 564728406 1483874379 -1494810927 1383402067 1205558049 172397619 160676765 2073075342 480154297 183593661 -2003499742 -630660980 629779018 643688812 552318118 -1778499633 1020616881 97148948 1093570883 -783959220 12844032 -1101612534 -690984844 -1430575371 1055256575 -506148006 2068384239 -1032484135 529561621 -1086095157 866484762 1424181752 37455764 -1387057441 581818360 -1936815296 -915491036 -1308945831 -574504857 1702876791 242314663 549096048 -900856726 -235693519 -1461186260 -1825957712 396873455 -1823222929 1315641542 -939596658 1088365420 531165540 1244543929 671746576 -262033145 -340598293 390645292 1198491307 1102630010 2057402938 641412074 -83283907 941908448 -1461930818 334567193 -1280707334 624914184 734948805 1432499889 1543913951 -1822141974 -6051978 392154082 -1321636176 -2085016293 123984121 -523814340 1994495280 1015456605 -1709652348 1252889163 1826981065 887601441 -516612123 -2031494097 87423574 -51418961 -1840761782 -536931852 -1865752745 -891111392 -48096781 -70163302 -173809283 456602775 -521339471 416734310 1367605134 -1677643532 203663731 -1500938443 1539472568 1693604927 1991793794 109154890 596656732 1413357260 -1484299464 -1255102515 -293321111 -1475186114 1603826432 -738269395 -1230912862 -99418635 -1639224565 288124937 -1873916115 1569236798 -667847849 1659893940 -767116958 -253046865 2005949952 -1074319852 -1489960499 1362512838 -144421467 -642674609 2029559097 -1944418174 1299265946 1663355426 670681462 -1390800301 1503167686 -1281813637 -511152520 1953280667 -744960339 1480459432 1663701844 405817576 -1836106034 1820069875 -491994447 -1049006886 962334749 633659597 1295356280 -1137041415 259751938 1111291843 -412323016 -482873457 -496921293 -2037029555 1103078227 1583491217 -132259808 -322158781 -189955443 -1509984167 -1165884372 1492279995 -2073280522 -1561053418 -1249596353 -73848778 -947016715 -1579624604 1316319197 -398762468
    ${output}=    Read Until Prompt
    Log    ${output}
    Should Contain X Times    ${output}    === [putSample] m1m3::logevent_AppliedCylinderForces writing a message containing :    1
    Should Contain    ${output}    revCode \ : LSST TEST REVCODE

Read Logger
    [Tags]    functional
    Switch Connection    Logger
    ${output}=    Read Until    ${component} received
    Log    ${output}
    Should Contain X Times    ${output}    Event ${subSystem} ${component} received     1
